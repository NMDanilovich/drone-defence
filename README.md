drone-defence
=

## Описание

Проект посвящен противодействию дронам в небе.

## Структура проекта

```
drone_defence/
├── app/
│   ├── camera_control/
│   │    ├── configs/     # Дир. с файлами конфигурации
│   │    ├── sorces/      # Дир. с исходниками
│   ├── calibration.py    # Скрипт для управления двигателями и калибровки
│   ├── core.py           # Модуль ядра детекции
│   ├── tracker.py        # Модуль трекера
│   └── visualisation.py  # Отрисовка и запись происходящего на трекинговой камере
├── start.py              # Точка запуска проекта
├── requirements.txt      # Зависимости Python
├── README.md             # Документация проекта
└── .gitignore            # Файлы и директории, игнорируемые Git
```

## Зависимости

Зависимости:
- Linux for tegra + jetson jetpack 6.2
- Cuda 12.6
- Gstreamer 
- Python 3.10
- OpenCV+cuda+gstreamer
- Pytorch 2.8
- Torchvision 0.22

OpenCV устанавливается из исходников. В папке tools лежит скрипт для установки необходимой версии с поддержкой CUDA и Gstreamer. 
Pytorch устанавливается из репозитория https://github.com/davidl-nv/torch/tree/main/torch-2.8 с использованием lfs. Так же для корректной установки библиотеки необходимо обновить setuptuls, скачать зависимости (libjpeg-dev libpng-dev libtiff-dev), и установить библиотеку от NVIDIA (https://developer.nvidia.com/cusparselt-downloads?target_os=Linux&target_arch=x86_64&Distribution=Ubuntu&target_version=22.04&target_type=deb_local)
Зависимости от Python библиотек прописаны в requirements.txt.


Дирректория `configs` содержжит следующие конфигурационные файлы:

- connections.example.conf
- system.example.conf

Изучите их содержимое и измените параметры для настройки системы. При использовании примеров файлов, система выдаст предупреждение и создаст копии файлов, которые можно изменять и желательно использовать.

## Использование

Перед запуском проекта настоятельно рекомендую ознакомиться с дирректорией configs, где лежат файлы конфигурации и провести калибровку обзорных камер.

Для запуска проекта используйте скрипт 

```bash
cd drone_defence/app
python3 start.py
```

## Методика калибровки 
Перед запуском проекта необходимо провести калибровку обзорных камер. Это нужно сделать для корректного наведения платформы на искомый объект. Калибровка привязывает систему координат нижнего двигателя к положению камер.

### Ручная калибровка
Для проведения ручной калибровки перейдите в директорию с скриптом калибровки данном репозитории

```bash
cd drone_defence/app/camera_controll
```

В директории app/camera_control/configs лежит шаблон конфигурационного файла калибровки system.conf. Для удобства откройте его в соседнем окне vscode командой 

```bash
code app/camera_control/configs/system.conf
```

Или в соседнем окне терминала

```bash
nano app/camera_control/configs/system.conf
```

Шаблон имеет структуру

```ini
[CALIBRATION]
camera_1 = 0
...
camera_N = 9999
```

Сколько камер стоит в обзорной части, столько и строк должно быть. На место чисел, указанных по умолчанию, необходимо будет подставить калибровочные значения.

Для получения калибровочных значений перейдите к скрипту calibration.py и запустите команду для получения информации по использованию

```bash
python3 calibration.py --help
```

> Примечание:
> Для установки платформы в стартовое положения используйте флаг 
> ```bash
> python3 calibration.py --start
> ```
> Для изменения положения установки по оси X (рысканье) используйте 
> ```bash
> python3 calibration.py --x N
> ```
> Для изменения положения установки по оси Y (тангаж) используйте
> ```bash
> python3 calibration.py --y N
> ```
> Где N - любое целочисленное значение. Для обоих флагов N по умолчанию равно 0. Для изменения положения используются относительные координаты (предыдущее положение + N).
> Для обнуления координат по оси X используйте
> ```bash
> python3 calibration.py --zero
> ```

Для удобства, откройте камеры с помощью веб интерфейса или иной программы для просмотра видеопотока с обзорных камер.

Далее необходимо провести ручную калибровку.
Алгоритм калибровки:
1) Перевести платформу в стартовое положение.
2) Максимально соотнести изображения с первой обзорной камеры и трекингововй камеры.
3) Отправить команду zero на контроллер
4) Задать угол каждой камеры и внести его в CALIBRATION секцию в system.conf.

## Контакты